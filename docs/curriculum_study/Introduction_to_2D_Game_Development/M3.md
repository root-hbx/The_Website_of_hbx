# Module 3 UI, Interaction, Game Manager, Gradual Changes, Autonomous Behavior

## Coverage

Unity specific skills you will need, practice, and demonstrate include:

Â·Â Â Â Â Â Â Â Â Â User Interface

oÂ Â Â Sharing the editor between theÂ GameObjectÂ world and the UI coordinate system

oÂ Â Â Working with UIÂ RectTransform

Â·Â Â Â Â Â Â Â Â Â Packages: create and import

Concepts you will explore and understand include

Â·Â Â Â Â Â Â Â Â Â The lerp function: gradual rotation and chasing

Â·Â Â Â Â Â Â Â Â Â Simple implementation of a finite state machine

Â·Â Â Â Â Â Â Â Â Â Randomness and simple examples in games (again)

**1.**Â Â Â Â Â Â **[User Interface and Packages](https://myuwbclasses.github.io/XJTU-IntroGameDev/Classnotes/Module-3/WebGL-Builds/3.1):**Â Example based on Module-2 Example-4

oÂ Â Â Â **Run Behavior:**Â press-space bar to launch egg at slider-bar-value interval

oÂ Â Â Â **Packet Import:**

Â§Â Â AssetsÂ Ã¨Import Package: selectÂ SliderWithEcho.unitypackage

Â§Â Â From theÂ githubÂ look forÂ **ClassExample****/Packages**

Â§Â Â PreFab: UI-SliderWithEcho

Â§Â Â Scripts/UI/SliderWithEcho.cs

Â§Â Â To create your own package, do the reverse: AssetsÃ¨Export and select the appropriate components (remember to select the necessary scripts)

oÂ Â Â Â **UI**: Using the imported package

Â§Â Â Remember, first your scene must have a Canvas (create by: UIÃ Canvas)

Â§Â Â To use: dragÂ SliderWithEchoÂ pre-fab into the Canvas:

**1.**Â Â Â Â Â Â Align anchor: lower-left

Â§Â Â Rename to:Â SpawnRate

Â§Â Â Must configure: (SelectÂ SpawnRateÂ and look in the Inspector Window)

**1.**Â Â Â Â Â Â mLabelText

**2.**Â Â Â Â Â Â SliderValue: (this is a Text UI object)

**1.**Â Â Â Â Â Â Customize the text detail, e.g., color

**3.**Â Â Â Â Â Â SliderBarÂ (in the Slider component)

**1.**Â Â Â Â Â Â Set:Â Â Â Min Value, Max Value, Init Value

Â§Â Â Careful: when adjusting positions of theÂ SliderWithEchoÂ object, do not adjust the children positions!

oÂ Â Â Â **GreenArrowBehavior**: referenceÂ anÂ SliderWithEcho

Â§Â Â In the editor: drag the entireÂ SliderWithEchoÂ (SpawnRate) to theÂ GreenArrowBehaivorÂ object

Â§Â Â The value() ofÂ SpwanRateÂ is how many seconds to wait in between spawning new eggs

Â§Â Â Note:Â **Time.time**Â amount of seconds elapsed since the beginning of the game

oÂ Â Â Â **Learned:**

Â§Â Â Almost all Unity specific:

Â§Â Â Time.time: time (in seconds) after game began

Â§Â Â Package: import/export of prefab watch to check all dependent components

Â§Â Â Note the logic inÂ GreeArrowBehavior::Update() on check for spawn rate.

oÂ Â Â Â **Alternate implementation**:

Â§Â Â SpawnRateÃ¨SliderBarÂ has a call back (event handler)

Â§Â Â Can define a function inÂ GreenArrowBehaviorÂ and add the function here.

**1.**Â Â Â Â Â Â Pros: Receives value change via event, no need to refer inÂ update()

**2.**Â Â Â Â Â Â Cons: Implicit references (via event service functions), can be challenging to figure out all event handlers.

Â§Â Â I usually poll UI events inÂ Update() function.

Â§Â Â Exercise:

Â§Â Â Implement this alternative.

- **WARNING**: Text echo is not kind, default horizontal overflow is set to truncate, meaning, if a text is too long (e.g., number with many precision digits), the number will not show! Try it!!

- UI-CanvasÂ Ã SpawnRateÃ SliderValue: under Text (Script)

Â§Â Â A wrap in the horizontal and truncate in the vertical may result in part of the message not shown!

Â§Â Â Look forÂ **Horizontal Overflow**, try different settings!  
  

2. **[Cool Down Bar](https://myuwbclasses.github.io/XJTU-IntroGameDev/Classnotes/Module-3/WebGL-Builds/3.2):**Â simple continuation from the previous example

- **Run Behavior:**Â press-space bar to launch egg at slider-bar-value interval andÂ **_watch_**Â the cool down bar
- **Package Import**:

- AssetsÂ Ã¨Import Package: selectÂ CoolDownBar.unitypackage
- From theÂ githubÂ look forÂ **ClassExample****/Packages**

- PreFab: UI-CoolDownBar
- Scripts/UI/CoolDownBar.cs

- **UI**: Using the imported package

- Remember: you must have a Canvas (to create: UIÃ Canvas)
- Optional: set the value ofÂ _Sec_To_Cool_Down_

- SelectÂ CoolDownBar, and look for theÂ CoolDownBar.csÂ component

- **GreenArrowBehavior**: referenceÂ anÂ SliderWithEcho, andÂ CoolDownBar

- In the editor: connectÂ CoolDownBarÂ UI to the instance variable
- Note: theÂ re-spawn time restriction logic is now hidden

- **Learned:**Â Importance and beauty of OO,Â CoolDownBarÂ hides spawn rate logic fromÂ GreenArrowBehavior!  
      
      
    

4. **[Gradual Rotation and Chasing](https://myuwbclasses.github.io/XJTU-IntroGameDev/Classnotes/Module-3/WebGL-Builds/3.3)**

- **Run Behavior**:

- WASD: move the egg
- UpArrowÂ chase after the egg
- TurnRate:Â Â (be careful, slider bar may keep focus of mouse, click somewhere else to un-focus)

- 0 does not turn towards egg
- 1 always point at egg
- 0 < rate < 1: turns gradually from very slow (values close to 0), to very quick (values close to 1)

- **Egg**:Â WASD_Movement: trivial behavior
- **GreenArrowBehavior**:

- Public variables

- TurnRate: connects to the slider
- Target: connects to the egg

- PointAtPosition(): function

- Pointing theÂ transform.upÂ towards any given position

1. Incremental rotation ofÂ transform.upÂ to align with V
2. Watch out, ifÂ transform.upÂ and V are pointing in perfect opposite directions, the turning does not work.

- Update()

- CallsÂ PointAtPosition()
- Move in the direction ofÂ transform.up

- In game object movement consideration

- **Easy**: Direct control: you control the position of an object
- **Less Easy**: Indirect control: e.g., you control the velocity of an object
- **Obey the rules of physics:**Â Indirect control in the world with physics (gravity and potentials for collisions), you configure the physics to control the object movement
- **Follow your own algorithm**: No control: autonomous (as in this case)

- **Learned**:

- Gradual rotation**:**Â Vector3.lerpUnclamped()
- TheÂ **PointAtPosition****(****)**Â function

- Quite reusable

- In-game object movement considerations  
      
      
    

6. **[Autonomous Movement with Randomness](https://myuwbclasses.github.io/XJTU-IntroGameDev/Classnotes/Module-3/WebGL-Builds/3.4):**

- **Run Behavior**:

- Watch the green arrow chases the egg, when gets close, egg spawn in a new position in the pinkish area
- SliderBarÂ changes the pinkish area size (% of world bound size)
- N-Key: to spawn a newÂ GreenArrow
- H-Key: to hide the egg
- **Try**: spawn 20 arrows, and then hide the egg, see a bunch of patrolling arrows?!

- **Scene Setting**

- **MainCamera**: hasÂ **CameraSupport**: for setting and testing bounds

- Child:Â **GameManager****:**Â empty game object for hanging the singletonÂ GameManager
- **TargetBoundBox**Â (pinkish)

1. This box isÂ _behind_Â the green arrow (with larger Z-position values, the larger the Z the more behind).
2. **Be careful****:**Â camera settings only allows z values of up to 1000:Â **MainCamera.Far**

- **GreenArrow**: chases after the egg

- **GameManager**:

- Awake():

- Initialize must be done beforeÂ GreenArrowBehavior::Start()!

- Has reference

- CameraSupport: to compute world bound and target bound
- TargetBoundBox: to be scaled into the size user specified
- TargetBoundSlider: child of UI-Canvas, the slider bar

- GetTargetBound: computes the percentage of a given bound

- **GreenArrowBehavior****:**

- ComputeNewTargetPosition: a random target position within a given bound
- Vector.Distance(): Notice this function, convenient to use

- **Learned:**

- Compute the percentage of a given bound (**GameManager****::GetTargetBound()**)
- Random position in a bound (**GreenArrow****::ComputeNewTargetPosition()**)
- Distance between two game objects:Â **Vector3::Distance()**Â function
- Game object positions:Â **z values are important**

- Front is smaller z, behind/far is larger z
- SHOULD NOT change the z-value of an object during game play

1. May cause â€œflippingâ€ rotation
2. E.g., change the z value of Target to e.g., 1.0f and observe arrow flips

- SliderBarÂ callback function

- Efficient, only compute when there are changes
- Edited in the UI  
      
    

8. **[Finite State Machine](https://myuwbclasses.github.io/XJTU-IntroGameDev/Classnotes/Module-3/WebGL-Builds/3.5)**

- **Run Behavior**:

- Move the arrow with WASD
- Touch the plane to trigger fixed behavior

- **Finite State Machine**: Simple state on the Plane. Here is theÂ [state transition definition](https://myuwbclasses.github.io/XJTU-IntroGameDev/Classnotes/Module-3/EnemyState.jpg)

- Normally, nothing, when collision
- enlarge for 120 frames
- rotate CW fast for 80 frames
- rotate CCW for 80 frames
- shrink for 120 frames
- return to resting
- **Note:**Â in our context, if an operation does not need time, it is NOT a state. All states, in the FSM needs more than one update() cycle.

- **Implementation Keys**:

- Draw the state diagram!!
- Instance variables for state definition and transition
- EnumÂ for individual states
- Case statement in update()
- State service: Each state is a separate function!

- As states become complicated, they can be defined as instance of different classes (with shared base class)

- Organization

- Partial class (different files implementing the same class)
- Plane.csÂ Â andÂ Plane_FSM.cs

- Each contains separate details!

- **Learned**:

- Finite State Machine: important to

- Draw out ALL states, and
- Define all possible input and state transitions

- Implementation key: review the above!
- Relatively straightforward to define simple repetitive autonomous behaviors!
- C# Partial class: to help separate source code into different files for organization  
      
    

10. **[FSM + Randomness](https://myuwbclasses.github.io/XJTU-IntroGameDev/Classnotes/Module-3/WebGL-Builds/3.6)**

- **Run Behavior**:

- All planes cycles through states without going into resting
- Random enlarge and rotation periods (turn constants into variables)
- After a while, look rather random?

- **GameManager**: hanging offÂ MainCamera

- Creates all the planes at startup

- **Plane:**

- Randomness: in the Start() function, sets the number of frames in scale/rotate states to be random

- **Learned**:

- Beauty and simplicity of random

Â§Â Â Ease of expansion when well abstracted  
  

7. **[Orbiting](https://myuwbclasses.github.io/XJTU-IntroGameDev/Classnotes/Module-3/WebGL-Builds/3.7)**

- **Run Behavior**

- Eggs orbits around hero
- No UI support, must change from the editor, try

- Select Hero in Editor and move hero around (egg follows)
- Select Egg and change

1. Orbit Radius
2. Orbit Speed

- **Scene**:

- Egg is the satellite
- OrbitControlÃ HostXformÂ points to Heroâ€™sÂ xform

- OrbitControl.csÂ on the Egg (can be on any objects):

- Literally 3-lines of code!

- **Learned**:

- Nice to know quaternionÂ ðŸ˜Š.